#!/usr/bin/env python3
"""
–¢–µ—Å—Ç –ª–∞–∫–æ–Ω–∏—á–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–π–¥–∂–µ—Å—Ç–∞
"""

import sys
sys.path.append('src')

from src.news_collector import NewsCollector
from src.database import ChannelsDB
import asyncio

async def test_concise_format():
    """–¢–µ—Å—Ç –Ω–æ–≤–æ–≥–æ –ª–∞–∫–æ–Ω–∏—á–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞"""
    
    print("üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ª–∞–∫–æ–Ω–∏—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–π–¥–∂–µ—Å—Ç–∞...")
    
    # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    test_messages = [
        {
            'id': 2001,
            'text': 'üöÄ –Ø–Ω–¥–µ–∫—Å –∑–∞–ø—É—Å—Ç–∏–ª –Ω–æ–≤—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é —Å –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º. –°–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç GPT-4 –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –±–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –≤—É–∑–æ–≤.',
            'channel': '@edtexno',
            'link': 'https://t.me/edtexno/2001',
            'summary': '–Ø–Ω–¥–µ–∫—Å –∑–∞–ø—É—Å—Ç–∏–ª –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –æ–±—É—á–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é —Å GPT-4',
            'priority': 10
        },
        {
            'id': 2002, 
            'text': 'üìö Mail.ru Group –æ–±—ä—è–≤–∏–ª–∞ –æ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã –Ω–∞ –±–∞–∑–µ VK. –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ–Ω–ª–∞–π–Ω-–∫—É—Ä—Å–æ–≤, –≤–µ–±–∏–Ω–∞—Ä–æ–≤ –∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π –ø—Ä—è–º–æ –≤ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏.',
            'channel': '@te_st_channel',
            'link': 'https://t.me/te_st_channel/2002',
            'summary': 'VK –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—É—é —ç–∫–æ—Å–∏—Å—Ç–µ–º—É —Å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∫—É—Ä—Å–∞–º–∏',
            'priority': 5
        },
        {
            'id': 2003,
            'text': 'üéØ –°–±–µ—Ä –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –°–±–µ—Ä –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç —Å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏. –°—Ç—É–¥–µ–Ω—Ç—ã —Å–º–æ–≥—É—Ç –∏–∑—É—á–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã –≤ –∏–º–º–µ—Ä—Å–∏–≤–Ω–æ–π —Å—Ä–µ–¥–µ.',
            'channel': '@vc_edtech',  
            'link': 'https://t.me/vc_edtech/2003',
            'summary': '–°–±–µ—Ä –¥–æ–±–∞–≤–∏–ª VR-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –≤ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É',
            'priority': 10
        },
        {
            'id': 2004,
            'text': 'üí° –†–æ—Å—Å–∏–π—Å–∫–∞—è EdTech –∫–æ–º–ø–∞–Ω–∏—è MAXIMUM Education –ø—Ä–∏–≤–ª–µ–∫–ª–∞ $15 –º–ª–Ω –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è AI-–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –ï–ì–≠ –∏ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–º —ç–∫–∑–∞–º–µ–Ω–∞–º.',
            'channel': '@habr_career',
            'link': 'https://t.me/habr_career/2004', 
            'summary': 'MAXIMUM Education –ø—Ä–∏–≤–ª–µ–∫–ª–∞ $15M –¥–ª—è AI-–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –ï–ì–≠',
            'priority': 8
        },
        {
            'id': 2005,
            'text': 'üåê –ù–µ—Ç–æ–ª–æ–≥–∏—è –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–ª–∞ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –æ–±—É—á–µ–Ω–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é.',
            'channel': '@edcrunch',
            'link': 'https://t.me/edcrunch/2005',
            'summary': '–ù–µ—Ç–æ–ª–æ–≥–∏—è –≤–Ω–µ–¥—Ä–∏–ª–∞ –ò–ò –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–¥–∞–Ω–∏–π –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é',
            'priority': 7
        }
    ]
    
    # –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä NewsCollector
    collector = NewsCollector()
    
    # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞–π–¥–∂–µ—Å—Ç
    digest = collector.format_digest(test_messages)
    
    print("\n" + "="*60)
    print("üìÑ –†–ï–ó–£–õ–¨–¢–ê–¢ - –õ–ê–ö–û–ù–ò–ß–ù–´–ô –î–ê–ô–î–ñ–ï–°–¢:")
    print("="*60)
    print(digest)
    print("="*60)
    
    print(f"\nüìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:")
    print(f"   - –î–ª–∏–Ω–∞: {len(digest)} —Å–∏–º–≤–æ–ª–æ–≤")
    print(f"   - –ù–æ–≤–æ—Å—Ç–µ–π: {len(test_messages)}")
    print(f"   - –°—Ç—Ä–æ–∫: {digest.count(chr(10)) + 1}")

if __name__ == "__main__":
    asyncio.run(test_concise_format())