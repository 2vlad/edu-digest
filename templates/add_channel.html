{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-plus"></i> Добавить канал</h1>
    <a href="/channels" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Назад к каналам
    </a>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-info-circle"></i> Информация о канале</h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="mb-3">
                        <label for="username" class="form-label">Username канала <span class="text-danger">*</span></label>
                        <div class="input-group">
                            <span class="input-group-text">@</span>
                            <input type="text" class="form-control" id="username" name="username" 
                                   placeholder="edtech_news" required>
                        </div>
                        <div class="form-text">
                            Введите username канала без символа @. Например: edtech_news
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="display_name" class="form-label">Отображаемое название <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="display_name" name="display_name" 
                               placeholder="EdTech News Channel" required>
                        <div class="form-text">
                            Понятное название канала для отображения в админке
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="priority" class="form-label">Приоритет</label>
                        <select class="form-select" id="priority" name="priority">
                            <option value="0">0 - Низкий (обычные новости)</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5" selected>5 - Средний (важные новости)</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8 - Высокий (приоритетные)</option>
                            <option value="9">9</option>
                            <option value="10">10 - Максимальный (критически важные)</option>
                        </select>
                        <div class="form-text">
                            Приоритет влияет на порядок отображения новостей в дайджесте
                        </div>
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="/channels" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Отмена
                        </a>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-plus"></i> Добавить канал
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h6><i class="fas fa-lightbulb"></i> Советы по настройке</h6>
            </div>
            <div class="card-body">
                <h6>Уровни приоритета:</h6>
                <ul class="list-unstyled">
                    <li><span class="badge bg-success">0-3</span> Обычные каналы</li>
                    <li><span class="badge bg-warning">4-6</span> Важные каналы</li>
                    <li><span class="badge bg-danger">7-10</span> Критически важные</li>
                </ul>
                
                <hr>
                
                <h6>Требования к каналу:</h6>
                <ul class="small">
                    <li>Канал должен быть публичным</li>
                    <li>Содержимое на тему EdTech</li>
                    <li>Регулярные публикации</li>
                    <li>Качественный контент</li>
                </ul>
                
                <hr>
                
                <div class="text-muted small">
                    <i class="fas fa-info-circle"></i>
                    После добавления канал начнет мониториться при следующем запуске сбора новостей.
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
// Автоматическое заполнение display_name на основе username
document.getElementById('username').addEventListener('input', function() {
    const username = this.value.trim();
    const displayNameField = document.getElementById('display_name');
    
    // Если поле названия пустое, предлагаем вариант
    if (!displayNameField.value && username) {
        // Простое преобразование: edtech_news -> EdTech News
        const suggestion = username
            .replace(/_/g, ' ')
            .replace(/\b\w/g, l => l.toUpperCase());
        displayNameField.placeholder = suggestion;
    }
});

// Валидация формы
document.querySelector('form').addEventListener('submit', function(e) {
    const username = document.getElementById('username').value.trim();
    const displayName = document.getElementById('display_name').value.trim();
    
    if (!username || !displayName) {
        e.preventDefault();
        alert('Заполните все обязательные поля');
        return;
    }
    
    // Проверяем что username не содержит @
    if (username.startsWith('@')) {
        document.getElementById('username').value = username.substring(1);
    }
});
</script>
{% endblock %}